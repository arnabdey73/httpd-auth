# Dynamically generated by Chef on i-dbdeb540
# Any modifications will be overwritten by Chef.

<VirtualHost *:4504>
  ServerAdmin support@ctmsp.com

  # Disable TRACE Requests
  TraceEnable Off

  <Directory />
    AllowOverride None
    <Limit PUT POST DELETE PROPPATCH MKCOL COPY MOVE LOCK UNLOCK>
      Order Deny,Allow
      Deny from all
    </Limit>
  </Directory>

  # Default rule, deny all        
  <LocationMatch ^.*$>
    <Limit PUT POST DELETE PROPPATCH MKCOL COPY MOVE LOCK UNLOCK>
      Order Deny,Allow
      Deny from all
    </Limit>
  </LocationMatch>

  <LocationMatch ^/$>
    <LimitExcept PUT POST DELETE PROPPATCH MKCOL COPY MOVE LOCK UNLOCK>
      Order Allow,Deny
      Allow from all
    </LimitExcept>
  </LocationMatch>

#  <LocationMatch ^/(apps|etc|home|libs|tmp|var)/$>
#     Order Allow,Deny
#     Allow from all
#  </LocationMatch>

  #
  # Paths for those who want to access content via webdav
  #
  <LocationMatch ^/content/$>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  # Regex paths to allow - auto-generated from Chef via environments .json
  <LocationMatch ^/content/geometrixx.*$>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  <LocationMatch ^/content/dam(/.*)?$>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  # 
  # Adobe Drive required paths, allowing all webdav actions/protocols
  #
  <LocationMatch ^/crx/server/$>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  <LocationMatch ^/libs/cq/core/content/login.html/j_security_check>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  <LocationMatch ^/crx/server/crx\.default/jcr:root(/$|/content/dam/|/libs/cq/core/productinfo/version)>
     Order Allow,Deny
     Allow from all
  </LocationMatch>

  # Adobe Drive opens many various .json files corresponding to content - should be harmless
#  <LocationMatch ^/.+\.json$>
#     Order Allow,Deny
#     Allow from all
#  </LocationMatch>

  # Deny accessing directories that Adobe Drive will never need to access
  <LocationMatch ^/(system/|admin/|crx/packmgr/|crx/explorer/|crx/de/|libs/granite/security/content/admin\.html)>
    Order Deny,Allow
    Deny from all

    ProxyPass !
  </LocationMatch>

  LogLevel error 
  LogFormat "\"%{X-Forwarded-For}i\" %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined-elb
  CustomLog /var/www/apache2_logs/webdav.log combined-elb


  ProxyPreserveHost on
  ProxyPass        / http://localhost:4502/
  ProxyPassReverse / http://localhost:4502/
  
</VirtualHost>
